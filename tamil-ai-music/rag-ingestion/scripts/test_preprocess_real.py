import json
from src.preprocess import make_song_id, pick_lyrics_field, clean_lyrics, chunk_text, lyrics_hash

sample_line = r'''{"{"movie_title": "10 Enradhukulla", "movie_year": "2015", "movie_url": "https://www.tamil2lyrics.com/movies/10-enradhukulla/", "song_title": "Pathu Endrathukkulle Male Song Lyrics", "song_url": "https://www.tamil2lyrics.com/lyrics/pathu-endrathukkulle-male-song-lyrics/", "singer": "", "music_by": "", "english_lyrics": "Pathu Endrathukkulle Male Song Lyrics -10 Endrathukulla 2015 Film\n\nHome\n\nMovies\n\nMusic Directors List\n\nSingers List\n\nS.P. Balasubrahmanyam Songs\n\nS Janaki Songs\n\nLyrics\n\nAlbums\n\nArtists\n\nMani Amuthavan\n\nPathu Endrathukkulle Male Song Lyrics\nin\n10 Enradhukulla\n\nEnglish\n\nSingers\n:\nVishal Dadlani and Emcee Jesz\n\nMusic Director :\nD. Imman\n\nLyricist :\nMani Amudhavan\n\nMale :\n10,9,8,7,6,5,4,3,2,1\n\nPathu endrathukulla\n\nOnnu onnu rendu\n\nOnnu rendum moonu\n\nMoonu kulla naalu\n\nNaalu anju aaru\n\nAaru onnu ezhu\n\nEzhu kulla ettu\n\nEttu onnu onbathu\n\nOnbathu onnum pathu\n\nMale :\nPathu endrathukulla\n\nPathu endrathukulla\n\nPathu endrathukulla\n\nMale :\nVettai ithu vettai\n\nVengaioda koota\n\nThandavaena gate-ah\n\nMaathuko nee route ah\n\nSingathoda kaata\n\nAanda oru aata\n\nEnnikida paatha\n\nElla thanda maata\n\nMale :\nPathu endrathukulla\n\nPathu endrathukulla\n\nPathu endrathukulla\n\nMale :\nRapp…………..\n\nMale :\nPaatha ivan ambi\n\nPaathu poda thambi\n\nMinsaaram paayum kambi\n\nThodathada\n\nMale :\nOndikivan ondi\n\nBreakillatha vandi\n\nMothipudum kitta varathada\n\nYaarada inai\n\nAdakuvaan unai\n\nAaru kadal ezhu malai\n\nEttu thikkum suthi varauvaan\n\nMale :\nPathu endrathukulla\n\nMale :\nRapp……\n\nMale :\nFire ivar fireu\n\nCurrent ulla wire-u\n\nEmanoda kayiru\n\nThotta pogum uyiru\n\nThavaruda thavaru\n\nThalli konjam navuru\n\nIpo ipo theriyum\n\nIvanoda poweru\n\nMale :\nPathu endrathukulla\n\nPathu endrathukulla\n\nPathu endrathukulla\n\nMale :\nPathu endrathukulla\n\nPathu endrathukulla\n\nPathu endrathukulla\n\n:\n\n10,9,8,7,6,5,4,3,2,1", "tamil_lyrics": "தமிழ்\n\nவிஷால் டட்லானி மற்றும் எம்சி ஜெஸ்ஸ்\n\nஇசை அமைப்பாளர் :\nடி. இமான்\n\nபாடல் ஆசிரியர் :\nமணி அமுதவன்\n\nஆண் :\nபத்து எண்றதுக்குள்ள\n\nஆண் :\nஒண்ணும் ஒண்ணும் ரெண்டு\nரெண்டும் ஒண்ணும் மூணு மூணுக்குள்ள நாலு\nநாலு அஞ்சு ஆறு ஆறும் ஒண்ணும் ஏழு\nஏழுக்குள்ள எட்டு எட்டு ஒண்ணும் ஒன்பது\nஒன்பதொண்ணு பத்து\n\nஆண் :\nபத்து எண்றதுக்குள்ள\nபத்து எண்றதுக்குள்ள\nபத்து எண்றதுக்குள்ள…..\n\nஆண் :\nவேட்ட இது வேட்ட வேங்கையோட கோட்ட\nதாண்ட வேணா கேட்ட மாத்திக்கோடி ரூட்ட\nசிங்கத்தோட காட்ட ஆண்ட ஒரு ஆட்ட\nஎன்னிக்கிடா பாத்த எல்ல தாண்ட மாட்ட\n\nஆண் :\nபத்து எண்றதுக்குள்ள\nபத்து எண்றதுக்குள்ள\nபத்து எண்றதுக்குள்ள….. ஆ…\n\nஆண் :\nராப்…..\n\nஆண் :\nஹோ… பாத்தா இவன் அம்பி\nபாத்து போடா தம்பி\nமின்சாரம் பாயும் கம்பி தொடாதேடா\n\nஆண் :\nஒண்டிக்கிவன் ஒண்டி ப்ரேக் இல்லாத வண்டி\nமோதிப்புடும் கிட்ட வராதேடா\nயாருடா இணை அடக்குவான் உனை\nஹே ஆறு கடல் ஏழு மலை எட்டு திக்கும் சுத்தி வருவான்\n\nஆண் :\nபத்து எண்றதுக்குள்ள…..\n\nஆண் :\nராப் …..\n\nஆண் :\nஏ… ஃபையர் இவன் ஃபையர் கரண்ட் உள்ள ஒயறு\nஎமனோட கயிறு தொட்டா போகும் உயிரு\nடவரு டா டவரு தள்ளிக் கொஞ்சம் நவரு\nஇப்ப இப்ப தெரியும் இவனோட பவரு\n\nஆண் :\nபத்து எண்றதுக்குள்ள\nபத்து எண்றதுக்குள்ள\nபத்து எண்றதுக்குள்ள…..\n\nஆண் :\nபத்து எண்றதுக்குள்ள\nபத்து எண்றதுக்குள்ள\nபத்து எண்றதுக்குள்ள…..", "lyrics_translit": "Pathu Endrathukkulle Male Song Lyrics -10 Endrathukulla 2015 Film\n\nHome\n\nMovies\n\nMusic Directors List\n\nSingers List\n\nS.P. Balasubrahmanyam Songs\n\nS Janaki Songs\n\nLyrics\n\nAlbums\n\nArtists\n\nMani Amuthavan\n\nPathu Endrathukkulle Male Song Lyrics\nin\n10 Enradhukulla\n\nEnglish\n\nSingers\n:\nVishal Dadlani and Emcee Jesz\n\nMusic Director :\nD. Imman\n\nLyricist :\nMani Amudhavan\n\nMale :\n10,9,8,7,6,5,4,3,2,1\n\nPathu endrathukulla\n\nOnnu onnu rendu\n\nOnnu rendum moonu\n\nMoonu kulla naalu\n\nNaalu anju aaru\n\nAaru onnu ezhu\n\nEzhu kulla ettu\n\nEttu onnu onbathu\n\nOnbathu onnum pathu\n\nMale :\nPathu endrathukulla\n\nPathu endrathukulla\n\nPathu endrathukulla\n\nMale :\nVettai ithu vettai\n\nVengaioda koota\n\nThandavaena gate-ah\n\nMaathuko nee route ah\n\nSingathoda kaata\n\nAanda oru aata\n\nEnnikida paatha\n\nElla thanda maata\n\nMale :\nPathu endrathukulla\n\nPathu endrathukulla\n\nPathu endrathukulla\n\nMale :\nRapp…………..\n\nMale :\nPaatha ivan ambi\n\nPaathu poda thambi\n\nMinsaaram paayum kambi\n\nThodathada\n\nMale :\nOndikivan ondi\n\nBreakillatha vandi\n\nMothipudum kitta varathada\n\nYaarada inai\n\nAdakuvaan unai\n\nAaru kadal ezhu malai\n\nEttu thikkum suthi varauvaan\n\nMale :\nPathu endrathukulla\n\nMale :\nRapp……\n\nMale :\nFire ivar fireu\n\nCurrent ulla wire-u\n\nEmanoda kayiru\n\nThotta pogum uyiru\n\nThavaruda thavaru\n\nThalli konjam navuru\n\nIpo ipo theriyum\n\nIvanoda poweru\n\nMale :\nPathu endrathukulla\n\nPathu endrathukulla\n\nPathu endrathukulla\n\nMale :\nPathu endrathukulla\n\nPathu endrathukulla\n\nPathu endrathukulla\n\n:\n\n10,9,8,7,6,5,4,3,2,1", "lyrics_ta": "தமிழ்\n\nவிஷால் டட்லானி மற்றும் எம்சி ஜெஸ்ஸ்\n\nஇசை அமைப்பாளர் :\nடி. இமான்\n\nபாடல் ஆசிரியர் :\nமணி அமுதவன்\n\nஆண் :\nபத்து எண்றதுக்குள்ள\n\nஆண் :\nஒண்ணும் ஒண்ணும் ரெண்டு\nரெண்டும் ஒண்ணும் மூணு மூணுக்குள்ள நாலு\nநாலு அஞ்சு ஆறு ஆறும் ஒண்ணும் ஏழு\nஏழுக்குள்ள எட்டு எட்டு ஒண்ணும் ஒன்பது\nஒன்பதொண்ணு பத்து\n\nஆண் :\nபத்து எண்றதுக்குள்ள\nபத்து எண்றதுக்குள்ள\nபத்து எண்றதுக்குள்ள…..\n\nஆண் :\nவேட்ட இது வேட்ட வேங்கையோட கோட்ட\nதாண்ட வேணா கேட்ட மாத்திக்கோடி ரூட்ட\nசிங்கத்தோட காட்ட ஆண்ட ஒரு ஆட்ட\nஎன்னிக்கிடா பாத்த எல்ல தாண்ட மாட்ட\n\nஆண் :\nபத்து எண்றதுக்குள்ள\nபத்து எண்றதுக்குள்ள\nபத்து எண்றதுக்குள்ள….. ஆ…\n\nஆண் :\nராப்…..\n\nஆண் :\nஹோ… பாத்தா இவன் அம்பி\nபாத்து போடா தம்பி\nமின்சாரம் பாயும் கம்பி தொடாதேடா\n\nஆண் :\nஒண்டிக்கிவன் ஒண்டி ப்ரேக் இல்லாத வண்டி\nமோதிப்புடும் கிட்ட வராதேடா\nயாருடா இணை அடக்குவான் உனை\nஹே ஆறு கடல் ஏழு மலை எட்டு திக்கும் சுத்தி வருவான்\n\nஆண் :\nபத்து எண்றதுக்குள்ள…..\n\nஆண் :\nராப் …..\n\nஆண் :\nஏ… ஃபையர் இவன் ஃபையர் கரண்ட் உள்ள ஒயறு\nஎமனோட கயிறு தொட்டா போகும் உயிரு\nடவரு டா டவரு தள்ளிக் கொஞ்சம் நவரு\nஇப்ப இப்ப தெரியும் இவனோட பவரு\n\nஆண் :\nபத்து எண்றதுக்குள்ள\nபத்து எண்றதுக்குள்ள\nபத்து எண்றதுக்குள்ள…..\n\nஆண் :\nபத்து எண்றதுக்குள்ள\nபத்து எண்றதுக்குள்ள\nபத்து எண்றதுக்குள்ள…..", "youtube_video_id": "h38JkW2Hf-A", "youtube_url": "https://www.youtube.com/watch?v=h38JkW2Hf-A", "youtube_channel": "SonyMusicSouthVEVO", "youtube_view_count": 252091, "youtube_duration_sec": 264, "primary_mood": "romantic", "energy_level": "medium", "theme_tags": "longing,yearning", "is_family_friendly": true, "decade": "2010s"}
'''

row = json.loads(sample_line)

sid = make_song_id(
    row.get("song_title", ""),
    row.get("singer", ""),
    row.get("movie_title", ""),
    row.get("movie_year", ""),
)

raw = pick_lyrics_field(row)
cln = clean_lyrics(raw)
chs = chunk_text(cln, chunk_size=1200, overlap=200)
h = lyrics_hash(cln)

print("song_id:", sid)
print("picked_field_len:", len(raw))
print("clean_len:", len(cln))
print("chunks:", len(chs))
print("hash:", h)
print("first_chunk_preview:", chs[0][:120] if chs else "")
